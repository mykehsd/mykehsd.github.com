---
layout: default
title: Splunk logger for your magento application
tags: <i class="icon-tag"></i>splunk <i class="icon-tag"></i>magento
---
<p>Splunk is a great log management tool that can be a valuable resource for your magento deployment. You can send any type of content splunk and use it for historical analysis of sales data, catalog updates, systems interactions, api logging, etc. There are two ways to configure this interaction with splunk: #1) Have your splunk server listen on a port number that receives data. #2) Have splunk forwarders on every server that then relay the data. There's pro's and con's to each solution, however I think the easiest and most reliable is the first method. First we need to setup splunk to receive data over a port, navigate to the "Manager" section and find "Data inputs"</p>
<p><img class="posterous_plugin_object posterous_plugin_object_image" src="http://getfile7.posterous.com/getfile/files.posterous.com/webhines/1hv0NfRz8bzVIYc5mduMRkf1BxKPkZaxDOKiB11LBHMBc8nmtPY4LqoSZHqb/Unknown-4.png.thumb100.jpg?content_part=SlL8sipoRJkhPgJjKuCR" alt="" width="100" height="100" /></p>
<p>Add a new TCP input and write down the port # you select.</p>
<p><img class="posterous_plugin_object posterous_plugin_object_image" src="http://getfile3.posterous.com/getfile/files.posterous.com/webhines/TrZdM9NXeP15AH3uXMp4zSyxElv6zXZ5h0k7sMknuc0kFmFBtPMFUAYFLmSl/Unknown-3.png.thumb100.jpg?content_part=h79COLv4yXbFmMFv4aSR" alt="" width="100" height="100" /></p>
<p>Next we setup a log helper that will deliver the data to splunk (you could overwrite any of the existing functions like Mage::log(), however this method is a bit more selective what is sent over). <br /> <br />class YourModule_Log_Helper_Remote extends Mage_Core_Helper_Data { <br />&nbsp;private $host = ''; // Enter your IP address of the splunk server. <br />&nbsp;private $port = ''; // Enter your port number here <br />&nbsp;private $resource; <br />&nbsp;public function send ($data) { <br />&nbsp;&nbsp; try { <br />&nbsp;&nbsp; &nbsp; $this-&gt;resource = fsockopen($this-&gt;host, $this-&gt;port, $errno, $errstr, 10); <br />&nbsp;&nbsp; &nbsp; fwrite($this-&gt;resource, $data); <br />&nbsp;&nbsp; &nbsp; fclose($this-&gt;resource); <br />&nbsp;&nbsp; } catch (Exception $e) { <br />&nbsp;&nbsp; &nbsp; Mage::log("Could not write to remote logging agent: $data\n"); <br />&nbsp;&nbsp; } <br />&nbsp;}</p>
<p>} <br /> <br /> <br /> <br />To invoke the service just execute: <br /> Mage::helper('log/remote')-&gt;sent("This text will be sent to splunk"); <br /> <br />It's best to format your log lines in a splunk friendly way. It will automatically index any data that has a key=value format like: <br /> "sku=123456 has been deactivated" <br /> "order_id=4956 has been sent to fulfillment" <br /> "customer_id=444938 imported from Ebay API" <br /> <br /> <br />Good luck!</p>
